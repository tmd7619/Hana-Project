<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="myPage.HistoryDAO"><!--  패키지명(fullname) 적어도 됨 // 보통 적는 것이 보편적-->


    <resultMap id="historyMap" type="HistoryVO">
        <result column="cslt_time" property="csltTime"/>
        <result column="cslt_title" property="csltTitle"/>
        <result column="cslt_comment" property="csltComment"/>
        <result column="room_number" property="roomNumber"/>
        <result column="pb_name" property="pbName"/>
        <result column="branch_name" property="branchName"/>
        <result column="client_id" property="clientId"/>
    </resultMap>


    <insert id="insertHistory" parameterType="historyVO">
        insert into consulting_history(client_id, pb_code_num, cslt_title, cslt_comment, consulting_history_id,
                                       room_number, pb_name, username, branch_name)
        values ( #{clientId}, #{pbCodeNum}, #{csltTitle}, #{csltComment}, consulting_history_seq.nextval, #{roomNumber}
               , #{pbName}, #{username}, #{branchName})
    </insert>


    <!-- 총 history 갯수 출력 -->
    <select id="countBoard" resultType="int">
        SELECT COUNT(*)
        FROM consulting_history
    </select>

    <!-- 페이징 처리 후 게시글 조회 ( client) -->
    <select id="selectAllHistory" resultMap="historyMap" parameterType="pagingVO">
        SELECT cslt_title
             , cslt_comment
             , pb_name
             , branch_name
             , to_char(cslt_time, 'yyyy-mm-dd HH24:mi') as cslt_time
             , room_number
             , username
        FROM (
                 SELECT ROWNUM RN, A.*
                 FROM (
                          SELECT *
                          FROM consulting_history
                          ORDER BY cslt_time DESC
                      ) A
             )
        WHERE RN BETWEEN #{start} AND #{end}
          and client_id = #{userId}
    </select>

    <!-- 페이징 처리 후 게시글 조회 Banker-->
    <select id="selectAllHistoryByBanker" resultMap="historyMap" parameterType="pagingVO">
        SELECT cslt_title
             , cslt_comment
             , pb_name
             , branch_name
             , to_char(cslt_time, 'yyyy-mm-dd HH24:mi') as cslt_time
             , room_number
        FROM (
                 SELECT ROWNUM RN, A.*
                 FROM (
                          SELECT *
                          FROM consulting_history
                          ORDER BY cslt_time DESC
                      ) A
             )
        WHERE RN BETWEEN #{start} AND #{end}
          and pb_code_num = #{pbCodeNum}
    </select>

</mapper>